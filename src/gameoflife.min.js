function getCellFromMousePos(i,e){if(i[0]<e.left||i[0]>e.right||i[1]<e.top||i[1]>e.bottom)return[-1,-1];var l=Math.floor((i[0]-e.left)/(cellSize+lineWidth)),t=Math.floor((i[1]-e.top)/(cellSize+lineWidth));return[l,t]}function isValidCell(i){return i[0]>=0&&i[0]<gridWidth&&i[1]>=0&&i[1]<gridHeight}function setCell(i,e,l,t){isValidCell(e)&&i[e[1]][e[0]]!=l&&(i[e[1]][e[0]]=l,t.push([e[0],e[1]]))}function clearCells(i,e){for(var l=0;gridHeight>l;++l)for(var t=0;gridWidth>t;++t)setCell(i,[t,l],0,e)}function countLivingNeighbors(i,e,l){for(var t=0,r=-1;1>=r;++r){var n=l+r;0>n&&(n+=gridHeight),n>=gridHeight&&(n-=gridHeight);for(var a=-1;1>=a;++a){var d=e+a;0>d&&(d+=gridWidth),d>=gridWidth&&(d-=gridWidth),t+=i[n][d]}}return 1==i[l][e]&&--t,t}function drawGridLines(i){i.strokeStyle=gridStrokeStyle,i.beginPath();for(var e=1;gridHeight>e;++e)i.moveTo(0,(cellSize+lineWidth/2)*e+lineWidth/2*(e-1)),i.lineTo(width,(cellSize+lineWidth/2)*e+lineWidth/2*(e-1));for(var l=1;gridWidth>l;++l)i.moveTo((cellSize+lineWidth/2)*l+lineWidth/2*(l-1),0),i.lineTo((cellSize+lineWidth/2)*l+lineWidth/2*(l-1),height);i.stroke()}function removeHighlight(i,e,l){if(isValidCell(l)){var t=l[0],r=l[1],n=(cellSize+lineWidth)*t,a=(cellSize+lineWidth)*r;1==e[r][t]?(i.fillStyle=cellFillStyle,i.fillRect(n,a,cellSize,cellSize)):(i.fillStyle=cellEmptyStyle,i.fillRect(n,a,cellSize,cellSize))}}function drawHighlight(i,e,l){isValidCell(l)&&(i.globalAlpha=.6,i.fillStyle=highlightFillStyle,i.fillRect((cellSize+lineWidth)*l[0],(cellSize+lineWidth)*l[1],cellSize,cellSize),i.globalAlpha=1)}function draw(i,e,l,t){for(var r=0;r<t.length;++r){var n=t[r][0],a=t[r][1],d=(cellSize+lineWidth)*n,h=(cellSize+lineWidth)*a;1==e[t[r][1]][n]?(i.fillStyle=cellFillStyle,i.fillRect(d,h,cellSize,cellSize)):(i.fillStyle=cellEmptyStyle,i.fillRect(d,h,cellSize,cellSize))}t.length=0,drawHighlight(i,e,l)}function update(i,e,l,t,r){if(!l){for(var n=JSON.parse(JSON.stringify(e)),a=!1,d=0;gridHeight>d;++d)for(var h=0;gridWidth>h;++h){var o=countLivingNeighbors(n,h,d);1==e[d][h]?(2>o||o>3)&&(setCell(e,[h,d],0,t),a=!0):3==o&&(setCell(e,[h,d],1,t),a=!0)}a&&draw(i,e,r,t)}}function start(){function v(){n=!n,c.text(n?"Play":"Pause")}for(var i=document.getElementById("grid"),e=i.getContext("2d"),l=new Array(gridHeight),t=0;gridHeight>t;++t){l[t]=new Array(gridWidth);for(var r=0;gridWidth>r;++r)l[t][r]=0}i.width=width,i.height=height,e.lineWidth=lineWidth;var d,n=!0,a=!1,h=1,o=[],g=[-1,-1];drawGridLines(e),setInterval(function(){update(e,l,n,o,g)},updateInterval),$(window).on("mousedown",function(i){isValidCell(g)&&(a=!0,h=!l[g[1]][g[0]],setCell(l,g,h,o))}),$(window).on("mousemove",function(t){d=[t.clientX,t.clientY];var r=g;g=getCellFromMousePos(d,i.getBoundingClientRect()),(r[0]!=g[0]||r[1]!=g[1]||isValidCell(r)&&!isValidCell(g))&&(removeHighlight(e,l,r),draw(e,l,g,o)),isValidCell(g)&&a&&setCell(l,g,h,o)}),$(window).on("mouseup",function(i){a=!1});var c=$("#pauseButton");c.on("click",function(i){v(n)}),$("#clearButton").on("click",function(i){clearCells(l,o),draw(e,l,g,o)})}var gridWidth=50,gridHeight=50,cellSize=10,lineWidth=2,cellFillStyle="#fff",cellEmptyStyle="#000",highlightFillStyle="#faa",gridStrokeStyle="#666",updateInterval=100,width=gridWidth*(cellSize+lineWidth)-lineWidth,height=gridHeight*(cellSize+lineWidth)-lineWidth;start();