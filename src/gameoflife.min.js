function getCellFromMousePos(i,e){var t=Math.floor((i[0]-e.left)/(cellSize+lineWidth)),r=Math.floor((i[1]-e.top)/(cellSize+lineWidth));return[t,r]}function toggleCell(i,e){i[e[1]][e[0]]=!i[e[1]][e[0]]}function setCell(i,e,t){i[e[1]][e[0]]=t}function countNeighbors(i,e,t){for(var r=0,l=-1;1>=l;++l){var n=t+l;0>n&&(n+=gridHeight),n>=gridHeight&&(n-=gridHeight);for(var d=-1;1>=d;++d){var o=e+d;0>o&&(o+=gridWidth),o>=gridWidth&&(o-=gridWidth),r+=i[n][o]}}return 1==i[t][e]&&--r,r}function drawGrid(i){i.strokeStyle=gridStrokeStyle,i.beginPath();for(var e=1;gridHeight>e;++e)i.moveTo(0,(cellSize+lineWidth/2)*e+lineWidth/2*(e-1)),i.lineTo(width,(cellSize+lineWidth/2)*e+lineWidth/2*(e-1));for(var t=1;gridWidth>t;++t)i.moveTo((cellSize+lineWidth/2)*t+lineWidth/2*(t-1),0),i.lineTo((cellSize+lineWidth/2)*t+lineWidth/2*(t-1),height);i.stroke()}function draw(i,e,t,r,l,n){if(t){var d=getCellFromMousePos(r,l);setCell(e,d,n)}i.clearRect(0,0,width,height),drawGrid(i),i.fillStyle=cellFillStyle;for(var o=0;gridHeight>o;++o)for(var a=(cellSize+lineWidth)*o,g=0;gridWidth>g;++g)if(1==e[o][g]){var h=(cellSize+lineWidth)*g;i.fillRect(h,a,cellSize,cellSize)}}function update(i,e){if(!e)for(var t=JSON.parse(JSON.stringify(i)),r=0;gridHeight>r;++r)for(var l=0;gridWidth>l;++l){var n=countNeighbors(t,l,r);2>n?i[r][l]=0:n>3?i[r][l]=0:3==n&&(i[r][l]=1)}}function start(){function u(){d=!d,h.text(d?"Play":"Pause")}for(var i=document.getElementById("grid"),e=i.getContext("2d"),t=new Array(gridHeight),r=0;gridHeight>r;++r){t[r]=new Array(gridWidth);for(var l=0;gridWidth>l;++l)t[r][l]=0}i.width=width,i.height=height;var n=i.getBoundingClientRect();e.lineWidth=lineWidth;var a,d=!0,o=!1,g=1;setInterval(function(){update(t,d)},updateInterval),setInterval(function(){draw(e,t,o,a,n,g)},updateInterval/2),$("#grid").on("mousedown",function(e){o=!0,a=[e.clientX,e.clientY];var r=getCellFromMousePos(a,i.getBoundingClientRect());g=!t[r[1]][r[0]]}),$("#grid").on("mousemove",function(i){a=[i.clientX,i.clientY]}),$("#grid").on("mouseup",function(i){o=!1}),$(window).scroll(function(e){n=i.getBoundingClientRect()}),$(window).resize(function(e){n=i.getBoundingClientRect()});var h=$("#pauseButton");h.on("click",function(i){u(d)})}var gridWidth=50,gridHeight=50,cellSize=10,lineWidth=2,cellFillStyle="#fff",gridStrokeStyle="#666",updateInterval=100,width=gridWidth*(cellSize+lineWidth)-lineWidth,height=gridHeight*(cellSize+lineWidth)-lineWidth;start();