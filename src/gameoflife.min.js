function getCellFromMousePos(e,i){var t=Math.floor((e[0]-i.left)/(cellSize+lineWidth)),r=Math.floor((e[1]-i.top)/(cellSize+lineWidth));return[t,r]}function toggleCell(e,i){e[i[1]][i[0]]=!e[i[1]][i[0]]}function setCell(e,i,t){e[i[1]][i[0]]=t}function countNeighbors(e,i,t){for(var r=0,l=-1;1>=l;++l){var d=t+l;0>d&&(d+=gridHeight),d>=gridHeight&&(d-=gridHeight);for(var n=-1;1>=n;++n){var a=i+n;0>a&&(a+=gridWidth),a>=gridWidth&&(a-=gridWidth),r+=e[d][a]}}return 1==e[t][i]&&--r,r}function drawGrid(e){e.strokeStyle=gridStrokeStyle,e.beginPath();for(var i=1;gridHeight>i;++i)e.moveTo(0,(cellSize+lineWidth/2)*i+lineWidth/2*(i-1)),e.lineTo(width,(cellSize+lineWidth/2)*i+lineWidth/2*(i-1));for(var t=1;gridWidth>t;++t)e.moveTo((cellSize+lineWidth/2)*t+lineWidth/2*(t-1),0),e.lineTo((cellSize+lineWidth/2)*t+lineWidth/2*(t-1),height);e.stroke()}function draw(e,i,t,r,l,d){if(t){var n=getCellFromMousePos(r,l);setCell(i,n,d)}e.clearRect(0,0,width,height),drawGrid(e),e.fillStyle=cellFillStyle,e.beginPath();for(var a=0;gridHeight>a;++a)for(var o=(cellSize+lineWidth)*a,h=0;gridWidth>h;++h)if(1==i[a][h]){var g=(cellSize+lineWidth)*h;e.fillRect(g,o,cellSize,cellSize)}e.stroke()}function update(e,i){if(!paused){e=JSON.parse(JSON.stringify(i));for(var t=0;gridHeight>t;++t)for(var r=0;gridWidth>r;++r){var l=countNeighbors(e,r,t);2>l?i[t][r]=0:l>3?i[t][r]=0:3==l&&(i[t][r]=1)}}}function start(){for(var e=document.getElementById("grid"),i=e.getContext("2d"),t=new Array(gridHeight),r=new Array(gridHeight),l=0;height>l;++l)t[l]=new Array(gridWidth),r[l]=new Array(gridWidth);for(var d=0;gridHeight>d;++d)for(var n=0;gridWidth>n;++n)t[d][n]=0;e.width=width,e.height=height;var a=e.getBoundingClientRect();i.lineWidth=lineWidth,paused=!0;var h,o=!1,g=1;setInterval(function(){update(r,t)},updateInterval),setInterval(function(){draw(i,t,o,h,a,g)},updateInterval/2),$("#grid").on("mousedown",function(i){o=!0,h=[i.clientX,i.clientY];var r=getCellFromMousePos(h,e.getBoundingClientRect());g=!t[r[1]][r[0]],console.log("setValue: "+g)}),$("#grid").on("mousemove",function(e){h=[e.clientX,e.clientY]}),$("#grid").on("mouseup",function(e){o=!1})}function togglePaused(){paused=!paused,pauseButton.text(paused?"Play":"Pause")}var gridWidth=50,gridHeight=50,cellSize=10,lineWidth=2,cellFillStyle="#fff",gridStrokeStyle="#666",updateInterval=100,paused,width=gridWidth*(cellSize+lineWidth)-lineWidth,height=gridHeight*(cellSize+lineWidth)-lineWidth,pauseButton=$("#pauseButton");pauseButton.on("click",function(e){togglePaused()}),start();