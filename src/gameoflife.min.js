function getCellFromMousePos(i,l){if(i[0]<l.left||i[0]>l.right||i[1]<l.top||i[1]>l.bottom)return[-1,-1];var e=Math.floor((i[0]-l.left)/(cellSize+lineWidth)),t=Math.floor((i[1]-l.top)/(cellSize+lineWidth));return[e,t]}function isValidCell(i){return i[0]>=0&&i[0]<gridWidth&&i[1]>=0&&i[1]<gridHeight}function setCell(i,l,e,t){isValidCell(l)&&(i[l[1]][l[0]]=e,t.push([l[0],l[1]]))}function clearCells(i){for(var l=0;gridHeight>l;++l)for(var e=0;gridWidth>e;++e)i[l][e]=0}function countLivingNeighbors(i,l,e){for(var t=0,r=-1;1>=r;++r){var n=e+r;0>n&&(n+=gridHeight),n>=gridHeight&&(n-=gridHeight);for(var a=-1;1>=a;++a){var d=l+a;0>d&&(d+=gridWidth),d>=gridWidth&&(d-=gridWidth),t+=i[n][d]}}return 1==i[e][l]&&--t,t}function drawGridLines(i){i.strokeStyle=gridStrokeStyle,i.beginPath();for(var l=1;gridHeight>l;++l)i.moveTo(0,(cellSize+lineWidth/2)*l+lineWidth/2*(l-1)),i.lineTo(width,(cellSize+lineWidth/2)*l+lineWidth/2*(l-1));for(var e=1;gridWidth>e;++e)i.moveTo((cellSize+lineWidth/2)*e+lineWidth/2*(e-1),0),i.lineTo((cellSize+lineWidth/2)*e+lineWidth/2*(e-1),height);i.stroke()}function removeHighlight(i,l,e){if(isValidCell(e)){var t=e[0],r=e[1],n=(cellSize+lineWidth)*t,a=(cellSize+lineWidth)*r;1==l[r][t]?(i.fillStyle=cellFillStyle,i.fillRect(n,a,cellSize,cellSize)):(i.fillStyle=cellEmptyStyle,i.fillRect(n,a,cellSize,cellSize))}}function drawHighlight(i,l,e){isValidCell(e)&&(i.globalAlpha=.6,i.fillStyle=highlightFillStyle,i.fillRect((cellSize+lineWidth)*e[0],(cellSize+lineWidth)*e[1],cellSize,cellSize),i.globalAlpha=1)}function draw(i,l,e,t){for(var r=0;r<t.length;++r){var n=t[r][0],a=t[r][1],d=(cellSize+lineWidth)*n,h=(cellSize+lineWidth)*a;1==l[t[r][1]][n]?(i.fillStyle=cellFillStyle,i.fillRect(d,h,cellSize,cellSize)):(i.fillStyle=cellEmptyStyle,i.fillRect(d,h,cellSize,cellSize))}t.length=0,drawHighlight(i,l,e)}function update(i,l,e){if(!l)for(var t=JSON.parse(JSON.stringify(i)),r=0;gridHeight>r;++r)for(var n=0;gridWidth>n;++n){var a=countLivingNeighbors(t,n,r);1==i[r][n]?(2>a||a>3)&&setCell(i,[n,r],0,e):3==a&&setCell(i,[n,r],1,e)}}function start(){function v(){n=!n,c.text(n?"Play":"Pause")}for(var i=document.getElementById("grid"),l=i.getContext("2d"),e=new Array(gridHeight),t=0;gridHeight>t;++t){e[t]=new Array(gridWidth);for(var r=0;gridWidth>r;++r)e[t][r]=0}i.width=width,i.height=height,l.lineWidth=lineWidth;var d,n=!0,a=!1,h=1,o=[],f=[-1,-1];drawGridLines(l),setInterval(function(){update(e,n,o)},updateInterval),setInterval(function(){draw(l,e,f,o)},drawInterval),$(window).on("mousedown",function(i){isValidCell(f)&&(a=!0,h=!e[f[1]][f[0]],setCell(e,f,h,o))}),$(window).on("mousemove",function(t){d=[t.clientX,t.clientY];var r=f;f=getCellFromMousePos(d,i.getBoundingClientRect()),(r[0]!=f[0]||r[1]!=f[1]||isValidCell(r)&&!isValidCell(f))&&(removeHighlight(l,e,r),drawHighlight(l,e,f)),isValidCell(f)&&a&&setCell(e,f,h,o)}),$(window).on("mouseup",function(i){a=!1});var c=$("#pauseButton");c.on("click",function(i){v(n)}),$("#clearButton").on("click",function(i){clearCells(e)})}var gridWidth=50,gridHeight=50,cellSize=10,lineWidth=2,cellFillStyle="#fff",cellEmptyStyle="#000",highlightFillStyle="#faa",gridStrokeStyle="#666",updateInterval=100,drawInterval=1,width=gridWidth*(cellSize+lineWidth)-lineWidth,height=gridHeight*(cellSize+lineWidth)-lineWidth;start();