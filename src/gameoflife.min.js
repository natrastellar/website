function getCellFromMousePos(i,e){if(i[0]<e.left||i[0]>e.right||i[1]<e.top||i[1]>e.bottom)return[-1,-1];var l=Math.floor((i[0]-e.left)/(cellSize+kLineWidth)),t=Math.floor((i[1]-e.top)/(cellSize+kLineWidth));return[l,t]}function isValidCell(i){return i[0]>=0&&i[0]<gridWidth&&i[1]>=0&&i[1]<gridHeight}function setCell(i,e,l,t){isValidCell(e)&&i[e[1]][e[0]]!=l&&(i[e[1]][e[0]]=l,t.push([e[0],e[1]]))}function clearCells(i,e){for(var l=0;gridHeight>l;++l)for(var t=0;gridWidth>t;++t)setCell(i,[t,l],0,e)}function countLivingNeighbors(i,e,l){for(var t=0,r=-1;1>=r;++r){var n=l+r;0>n&&(n+=gridHeight),n>=gridHeight&&(n-=gridHeight);for(var a=-1;1>=a;++a){var d=e+a;0>d&&(d+=gridWidth),d>=gridWidth&&(d-=gridWidth),t+=i[n][d]}}return 1==i[l][e]&&--t,t}function drawGridLines(i){i.strokeStyle=gridStrokeStyle,i.beginPath();for(var e=1;gridHeight>e;++e)i.moveTo(0,(cellSize+kLineWidth/2)*e+kLineWidth/2*(e-1)),i.lineTo(width,(cellSize+kLineWidth/2)*e+kLineWidth/2*(e-1));for(var l=1;gridWidth>l;++l)i.moveTo((cellSize+kLineWidth/2)*l+kLineWidth/2*(l-1),0),i.lineTo((cellSize+kLineWidth/2)*l+kLineWidth/2*(l-1),height);i.stroke()}function removeHighlight(i,e,l){if(isValidCell(l)){var t=l[0],r=l[1],n=(cellSize+kLineWidth)*t,a=(cellSize+kLineWidth)*r;1==e[r][t]?(i.fillStyle=cellFillStyle,i.fillRect(n,a,cellSize,cellSize)):(i.fillStyle=cellEmptyStyle,i.fillRect(n,a,cellSize,cellSize))}}function drawHighlight(i,e,l){isValidCell(l)&&(i.globalAlpha=.6,i.fillStyle=highlightFillStyle,i.fillRect((cellSize+kLineWidth)*l[0],(cellSize+kLineWidth)*l[1],cellSize,cellSize),i.globalAlpha=1)}function draw(i,e,l,t){for(var r=0;r<t.length;++r){var n=t[r][0],a=t[r][1],d=(cellSize+kLineWidth)*n,h=(cellSize+kLineWidth)*a;1==e[t[r][1]][n]?(i.fillStyle=cellFillStyle,i.fillRect(d,h,cellSize,cellSize)):(i.fillStyle=cellEmptyStyle,i.fillRect(d,h,cellSize,cellSize))}t.length=0,drawHighlight(i,e,l)}function update(i,e,l,t,r){if(!l){for(var n=JSON.parse(JSON.stringify(e)),a=!1,d=0;gridHeight>d;++d)for(var h=0;gridWidth>h;++h){var o=countLivingNeighbors(n,h,d);1==e[d][h]?(2>o||o>3)&&(setCell(e,[h,d],0,t),a=!0):3==o&&(setCell(e,[h,d],1,t),a=!0)}a&&draw(i,e,r,t)}}function resizeCanvas(i,e,l){var t=$("#game").width();gridWidth=Math.floor(t/(cellSize+kLineWidth)),gridHeight=50,width=gridWidth*(cellSize+kLineWidth)-kLineWidth,height=gridHeight*(cellSize+kLineWidth)-kLineWidth;var r=document.getElementById("grid"),n=r.getContext("2d");r.width=width,r.height=height,$("#menu").width(r.width),n.clearRect(0,0,r.width,r.height),drawGridLines(n),i=[-1,-1];for(var a in e)e.pop();for(var a in l)l.pop();for(var d=0;gridHeight>d;++d){l[d]=new Array(gridWidth);for(var h=0;gridWidth>h;++h)l[d][h]=0}}function start(){function f(){t=!t,g.text(t?"Play":"Pause")}var n,i=document.getElementById("grid"),e=i.getContext("2d"),l=new Array(gridHeight),t=!0,r=!1,a=1,d=[],h=[-1,-1],o=[-1,-1];setInterval(function(){update(e,l,t,d,o)},updateInterval),$(window).on("mousedown",function(i){isValidCell(o)&&(r=!0,a=!l[o[1]][o[0]],setCell(l,o,a,d))}),$(window).on("mousemove",function(t){n=[t.clientX,t.clientY];var h=o;o=getCellFromMousePos(n,i.getBoundingClientRect()),(h[0]!=o[0]||h[1]!=o[1]||isValidCell(h)&&!isValidCell(o))&&(removeHighlight(e,l,h),draw(e,l,o,d)),isValidCell(o)&&r&&setCell(l,o,a,d)}),$(window).on("mouseup",function(i){r=!1});var g=$("#pauseButton");g.on("click",function(i){f(t)}),$("#clearButton").on("click",function(i){clearCells(l,d),draw(e,l,o,d)}),window.addEventListener("resize",function(i){resizeCanvas(h,d,l)}),resizeCanvas(h,d,l)}var gridWidth,gridHeight,kLineWidth=3,kCellSize=10,cellSize=kCellSize,width,height,cellFillStyle="#fff",cellEmptyStyle="#000",highlightFillStyle="#faa",gridStrokeStyle="#666",updateInterval=100;start();